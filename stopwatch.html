<!-- stopwatch.html ä¸»é¡µé¢ -->
<!DOCTYPE html>
<html lang="zh">
<head>
  <meta charset="UTF-8">
  <title>æœ¬åœ°ç½‘é¡µç§’è¡¨</title>
  <script defer src="timer.js"></script>
  <script defer src="ruleTable.js"></script>
  <script defer src="memoParser.js"></script>
  <script defer src="exportTomato.js"></script>
  <style>
    #lang-toggle {
      position: absolute;
      top: 1rem;
      right: 1rem;
    }
  </style>
</head>
<body>
  <button id="lang-toggle" onclick="toggleLang()">ğŸŒ English</button>
  <h1 data-zh="â±ï¸ æœ¬åœ°ç½‘é¡µç§’è¡¨" data-mix="â±ï¸ æœ¬åœ°ç½‘é¡µç§’è¡¨" data-en="â±ï¸ Local Stopwatch">â±ï¸ æœ¬åœ°ç½‘é¡µç§’è¡¨</h1>
  <div class="tabs">
    <button class="tab-button" onclick="showTab('tab-timer')" data-zh="è®¡æ—¶å™¨" data-mix="è®¡æ—¶å™¨" data-en="Timer">è®¡æ—¶å™¨</button>
    <button class="tab-button" onclick="showTab('tab-rules')" data-zh="å®šä¹‰å¤‡æ³¨è§£æè§„åˆ™" data-mix="å®šä¹‰Memoè§£æè§„åˆ™" data-en="Memo Parsing Rules">å®šä¹‰å¤‡æ³¨è§£æè§„åˆ™</button>
    <button class="tab-button" onclick="showTab('tab-export')" data-zh="ç•ªèŒ„åœŸè±†æ ¼å¼å¯¼å‡º" data-mix="ç•ªèŒ„åœŸè±†æ ¼å¼å¯¼å‡º" data-en="Tomato Export">ç•ªèŒ„åœŸè±†æ ¼å¼å¯¼å‡º</button>
    <button class="tab-button" onclick="showTab('tab-log')" data-zh="è¿è¡Œæ—¥å¿—å’Œå¤‡ä»½" data-mix="è¿è¡Œæ—¥å¿—å’Œå¤‡ä»½" data-en="Log & Backups">è¿è¡Œæ—¥å¿—å’Œå¤‡ä»½</button>

  </div>

  <div id="tab-timer" class="tab-content">
    <section id="display-section">
      <h2 data-zh="å½“å‰è®°å½•æ®µæŒç»­æ—¶é—´" data-mix="å½“å‰IntervalæŒç»­æ—¶é—´" data-en="Current Interval Duration">å½“å‰è®°å½•æ®µæŒç»­æ—¶é—´</h2>
      <div id="current-duration" class="big-time">00:00:00.00</div>
      <div class="sub-time" id="current-date"></div>

      <h2 data-zh="å½“å‰ç»å¯¹æ—¶é—´" data-mix="å½“å‰ç»å¯¹æ—¶é—´" data-en="Current Absolute Time">å½“å‰ç»å¯¹æ—¶é—´</h2>
      <div id="absolute-time" class="big-time">--:--:--</div>
      <div class="sub-time" id="absolute-date"></div>

      <h2 data-zh="ç¬¬ä¸€ä¸ªè®°å½•æ®µå¼€å§‹çš„æ—¶é—´" data-mix="ç¬¬ä¸€ä¸ªIntervalå¼€å§‹çš„æ—¶é—´" data-en="First Interval Start Time">ç¬¬ä¸€ä¸ªè®°å½•æ®µå¼€å§‹çš„æ—¶é—´</h2>
      <div id="initial-time" class="big-time">--:--:--</div>
      <div class="sub-time" id="initial-date"></div>
    </section>

    <section id="control-section">
      <input id="memo-input" placeholder="å½“å‰è®°å½•æ®µçš„å¤‡æ³¨..." maxlength="1000">
      <button onclick="rememberInterval()" data-zh="ğŸ“Œ è®°ä¸‹" data-mix="ğŸ“Œ è®°ä¸‹" data-en="ğŸ“Œ Remember">ğŸ“Œ è®°ä¸‹</button>
      <button onclick="confirmExportAndClear()" data-zh="ğŸ“ å¯¼å‡ºå¹¶æ¸…ç©ºè®°å½•" data-mix="ğŸ“ å¯¼å‡ºå¹¶æ¸…ç©ºè®°å½•" data-en="ğŸ“ Export & Clear">ğŸ“ å¯¼å‡ºå¹¶æ¸…ç©ºè®°å½•</button>
      <button onclick="exportIntervalsToCSV()" data-zh="ğŸ“¤ å¯¼å‡ºCSV" data-mix="ğŸ“¤ å¯¼å‡ºCSV" data-en="ğŸ“¤ Export CSV">ğŸ“¤ å¯¼å‡ºCSV</button>
    </section>
    <div id="interval-controls"></div>
    <button onclick="triggerManualBackup()" data-zh="ğŸ’¾ æ‰‹åŠ¨å¤‡ä»½" data-mix="ğŸ’¾ æ‰‹åŠ¨å¤‡ä»½" data-en="ğŸ’¾ Manual Backup">ğŸ’¾ æ‰‹åŠ¨å¤‡ä»½</button>
    <button onclick="restoreLatestBackup()" data-zh="ğŸ•˜ æ¢å¤å†å²å¤‡ä»½" data-mix="ğŸ•˜ æ¢å¤å†å²å¤‡ä»½" data-en="ğŸ•˜ Restore Backup">ğŸ•˜ æ¢å¤å†å²å¤‡ä»½</button>

    <section id="intervals-section">
      <h2 data-zh="å†å²è®°å½•" data-mix="å†å²è®°å½•" data-en="History">å†å²è®°å½•</h2>
      <div id="intervals-container"></div>
    </section>
  </div>

  <div id="tab-rules" class="tab-content" style="display:none">
    <h2 data-zh="å¤‡æ³¨è§£æè§„åˆ™" data-mix="Memoè§£æè§„åˆ™" data-en="Memo Parsing Rules">å¤‡æ³¨è§£æè§„åˆ™</h2>
    <button onclick="showRuleHelp()" data-zh="ğŸ“– ä½¿ç”¨æ–¹æ³•" data-mix="ğŸ“– ä½¿ç”¨æ–¹æ³•" data-en="ğŸ“– Help">ğŸ“– ä½¿ç”¨æ–¹æ³•</button>
    <button onclick="exportRules()" data-zh="ğŸ“¤ å¯¼å‡ºè§„åˆ™" data-mix="ğŸ“¤ å¯¼å‡ºè§„åˆ™" data-en="ğŸ“¤ Export Rules">ğŸ“¤ å¯¼å‡ºè§„åˆ™</button>
    <input type="file" id="import-rule-file" accept=".csv" onchange="importRules(event)">
    <button onclick="undoClearRules()" data-zh="â†©ï¸ æ’¤é”€æ¸…ç©ºè§„åˆ™" data-mix="â†©ï¸ æ’¤é”€æ¸…ç©ºè§„åˆ™" data-en="â†©ï¸ Undo Clear">â†©ï¸ æ’¤é”€æ¸…ç©ºè§„åˆ™</button>
    <table id="rule-table"></table>
  </div>

  <div id="tab-export" class="tab-content" style="display:none">
    <h2 data-zh="ğŸ… å¯¼å‡ºç•ªèŒ„åœŸè±†æ ¼å¼" data-mix="ğŸ… å¯¼å‡ºç•ªèŒ„åœŸè±†æ ¼å¼" data-en="ğŸ… Tomato Export">ğŸ… å¯¼å‡ºç•ªèŒ„åœŸè±†æ ¼å¼</h2>
    <button onclick="exportTomatoPotato()" data-zh="ğŸ“‹ ç”Ÿæˆå¹¶å¤åˆ¶" data-mix="ğŸ“‹ ç”Ÿæˆå¹¶å¤åˆ¶" data-en="ğŸ“‹ Generate & Copy">ğŸ“‹ ç”Ÿæˆå¹¶å¤åˆ¶</button>
    <div id="tomato-output"></div>
  </div>

  <div id="tab-log" class="tab-content" style="display:none">
    <h2 data-zh="ğŸ› ï¸ è¿è¡Œæ—¥å¿—" data-mix="ğŸ› ï¸ è¿è¡Œæ—¥å¿—" data-en="ğŸ› ï¸ Log">ğŸ› ï¸ è¿è¡Œæ—¥å¿—</h2>
    <button onclick="refreshLog()" data-zh="ğŸ”„ åˆ·æ–°æ—¥å¿—" data-mix="ğŸ”„ åˆ·æ–°æ—¥å¿—" data-en="ğŸ”„ Refresh Log">ğŸ”„ åˆ·æ–°æ—¥å¿—</button>
    <button onclick="copyLog()" data-zh="ğŸ“‹ å¤åˆ¶æ—¥å¿—" data-mix="ğŸ“‹ å¤åˆ¶æ—¥å¿—" data-en="ğŸ“‹ Copy Log">ğŸ“‹ å¤åˆ¶æ—¥å¿—</button>
    <button onclick="clearLog()" data-zh="ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—" data-mix="ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—" data-en="ğŸ—‘ï¸ Clear Log">ğŸ—‘ï¸ æ¸…ç©ºæ—¥å¿—</button>
    <pre id="log-content"></pre>
    <h3 data-zh="ğŸ“‚ å¯ç”¨å¤‡ä»½åˆ—è¡¨" data-mix="ğŸ“‚ å¯ç”¨å¤‡ä»½åˆ—è¡¨" data-en="ğŸ“‚ Available Backups">ğŸ“‚ å¯ç”¨å¤‡ä»½åˆ—è¡¨</h3>
    <div id="backup-list"></div>
    
  </div>

  <div id="confirm-clear-dialog" style="display:none; padding:1em; background:#fff; border:1px solid #ccc; position:fixed; top:30%; left:30%; z-index:9999; box-shadow:0 0 10px rgba(0,0,0,0.2);">
    <p data-zh="âš ï¸ æ˜¯å¦è¦å¯¼å‡ºæ‰€æœ‰è®°å½•å¹¶æ¸…ç©ºï¼Ÿæ“ä½œä¸å¯æ’¤é”€ã€‚" data-mix="âš ï¸ æ˜¯å¦è¦å¯¼å‡ºæ‰€æœ‰è®°å½•å¹¶æ¸…ç©ºï¼Ÿæ“ä½œä¸å¯æ’¤é”€ã€‚" data-en="âš ï¸ Export and clear all records? This cannot be undone.">âš ï¸ æ˜¯å¦è¦å¯¼å‡ºæ‰€æœ‰è®°å½•å¹¶æ¸…ç©ºï¼Ÿæ“ä½œä¸å¯æ’¤é”€ã€‚</p>
    <button onclick="exportThenClear()" data-zh="âœ… ç¡®è®¤å¯¼å‡ºå¹¶æ¸…ç©º" data-mix="âœ… ç¡®è®¤å¯¼å‡ºå¹¶æ¸…ç©º" data-en="âœ… Confirm Export & Clear">âœ… ç¡®è®¤å¯¼å‡ºå¹¶æ¸…ç©º</button>
    <button onclick="document.getElementById('confirm-clear-dialog').style.display='none'" data-zh="âŒ å–æ¶ˆ" data-mix="âŒ å–æ¶ˆ" data-en="âŒ Cancel">âŒ å–æ¶ˆ</button>
  <footer>
    <hr>
    <small>å‚è€ƒäº†åŸç½‘é¡µ https://stopwatch.online-timers.com/stopwatch-with-time-intervals çš„åŠŸèƒ½ï¼Œç”± ChatGPT é‡æ–°ç¼–å†™ä»£ç å¹¶æ·»åŠ äº†ä¸ªæ€§åŒ–ä¿®æ”¹ã€‚<br>é¡¹ç›®åœ°å€ï¼š<a href="https://github.com/SamZebrado/LocalStopWatch" target="_blank">https://github.com/SamZebrado/LocalStopWatch</a></small>
  </footer>

  <script>
    function showTab(id) {
      document.querySelectorAll('.tab-content').forEach(div => div.style.display = 'none');
      document.getElementById(id).style.display = 'block';
    }
    function confirmExportAndClear() {
      document.getElementById('confirm-clear-dialog').style.display = 'block';
    }
    function exportThenClear() {
      exportIntervalsToCSV();
      intervals = [];
      localStorage.setItem('intervals', JSON.stringify(intervals));
      document.getElementById('intervals-container').innerHTML = '';
      document.getElementById('confirm-clear-dialog').style.display = 'none';
    }
  // åˆå§‹åŒ–è¯­è¨€çŠ¶æ€ï¼ˆä¼˜å…ˆä» localStorage è¯»å–ï¼‰
  let currentLang = localStorage.getItem('lang') || 'mix';
  const langCycle = ['zh', 'mix', 'en'];

  function updateLangUI() {
    document.querySelectorAll('[data-zh]').forEach(el => {
      const val = el.getAttribute('data-' + currentLang);
      if (val) el.textContent = val;
    });

    // æŒ‰é’®æ˜¾ç¤ºä¸‹ä¸€ä¸ªè¯­è¨€åç§°
    const idx = langCycle.indexOf(currentLang);
    const nextLang = langCycle[(idx + 1) % langCycle.length];
    
    
    const labelMap = {
      zh: 'ğŸŒ ä¸­æ–‡',//è¿™æ ·èƒ½ä¸â€œä¸‹ä¸€ä¸ªâ€è¯­è¨€ä¸€è‡´
      mix: 'ğŸŒ ä¸­æ–‡+English',
      en: 'ğŸŒ English'
    };
    document.getElementById('lang-toggle').textContent = labelMap[nextLang];
  }

  function toggleLang() {
    const idx = langCycle.indexOf(currentLang);
    currentLang = langCycle[(idx + 1) % langCycle.length];
    localStorage.setItem('lang', currentLang);
    updateLangUI();
  }

  // é¡µé¢åŠ è½½ååº”ç”¨è¯­è¨€
  document.addEventListener('DOMContentLoaded', updateLangUI);

  </script>
</body>
</html>
